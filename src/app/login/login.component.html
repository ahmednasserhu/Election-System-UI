<section class="w-50 mx-auto shadow rounded p-4 my-5 bg-light mt-5">
  <h1 class="my-3 text-dark">Login</h1>
  <form [formGroup]="loginForm" (ngSubmit)="handleForm()">
    <div class="form-group">
      <input type="text" formControlName="ssn" id="ssn" class="form-control" [ngClass]="{ 'is-invalid': loginForm.get('ssn')?.invalid && loginForm.get('ssn')?.touched }" placeholder="Enter Your SSN ">
      <div *ngIf="loginForm.get('ssn')?.invalid && loginForm.get('ssn')?.touched" class="invalid-feedback">
        <div *ngIf="loginForm.get('ssn')?.hasError('required')">SSN is required</div>
        <div *ngIf="loginForm.get('ssn')?.hasError('invalidSSN')">Invalid SSN format</div>
      </div>
    </div>

    <div class="form-group">
      <input type="password" formControlName="password" id="password" class="form-control mt-3" [ngClass]="{ 'is-invalid': loginForm.get('password')?.invalid && loginForm.get('password')?.touched }" placeholder="Enter Password">
      <div *ngIf="loginForm.get('password')?.invalid && loginForm.get('password')?.touched" class="invalid-feedback">
        <div *ngIf="loginForm.get('password')?.hasError('required')">Password is required</div>
        <div *ngIf="loginForm.get('password')?.hasError('minlength')">Password must be at least 8 characters</div>
        <div *ngIf="loginForm.get('password')?.hasError('invalidPassword')">Password must contain uppercase, lowercase, number, and special character</div>
      </div>
    </div>

    <button [disabled]="loginForm.invalid" type="submit" class="btn btn-block bg-black main-btn text-white mt-3">
      Login
      <span *ngIf="isLoading"><i class="fab fa-spin fa-spinner"></i></span>
    </button>
    
    <p class="mt-3"><a (click)="openForgotPasswordModal()" class="text-decoration-none" style="cursor: pointer; color: brown;">Forgot Password?</a></p>
    <p class="mt-3">Don't have an account? <a routerLink="/register" class="text-decoration-none" style="color: brown;">Register</a></p>
  </form>

  <p *ngIf="errMsg" class="alert alert-danger mt-3">{{ errMsg }}</p>
</section>

<!-- Forgot Password Modal -->
<div class="modal fade" id="forgotPasswordModal" tabindex="-1" aria-labelledby="forgotPasswordModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="forgotPasswordModalLabel">Forgot Password</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <form [formGroup]="forgotPasswordForm" (ngSubmit)="handleForgotPassword()">
          <div class="form-group">
            <input type="email" formControlName="email" id="email" class="form-control" [ngClass]="{ 'is-invalid': forgotPasswordForm.get('email')?.invalid && forgotPasswordForm.get('email')?.touched }" placeholder="Enter Your Email">
            <div *ngIf="forgotPasswordForm.get('email')?.invalid && forgotPasswordForm.get('email')?.touched" class="invalid-feedback">
              <div *ngIf="forgotPasswordForm.get('email')?.hasError('required')">Email is required</div>
              <div *ngIf="forgotPasswordForm.get('email')?.hasError('email')">Invalid email format</div>
            </div>
          </div>
          <button [disabled]="forgotPasswordForm.invalid" type="submit" class="btn btn-primary mt-3">
            Send Reset Link
            <span *ngIf="isForgotPasswordLoading"><i class="fab fa-spin fa-spinner"></i></span>
          </button>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>
